<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localização dos Traumas</title>
    <link rel="shortcut icon" href="logo_noar.png" type="image/x-icon">
    <link rel="stylesheet" href="style-bootstrap.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');



        * {
            font-family: var(--main-font);
        }

        body {
            background-color: #c1c1c1;
            font-family: 'Inter', sans-serif;
            color: white;

        }

        .img-fluid.logo_noar {
            height: 10vh;
        }

        .offcanvas {
            width: 40% !important;
        }

        .card {
            background-color: var(--form-box-color) !important;
        }

        .formScroll a {
            background-color: var(--form-box-color);
            border: 1px solid rgba(245, 245, 245, 0.815)
        }

        .formScroll a:hover {
            background-color: var(--main-color);
            border: 1px solid rgba(245, 245, 245, 0.815);
        }

        .active {
            background-color: var(--second-color) !important;
            border: 1px solid rgba(245, 245, 245, 0.815) !important;
        }

        .font-small {
            font-size: 14px;
        }

        .border-right-dark {
            border-right: 3px solid rgba(0, 0, 0, 0.5);
        }

        .img-small {
            width: 40px;
            height: 40px;
        }

        .table-container {
            display: flex;
            justify-content: center;
        }

        .table {
            width: auto !important;
        }

        #nav {
            background-color: #333333;
            color: white;
        }

        .navbar-brand {
            display: flex;
            margin: 0px;
        }
    </style>
</head>
<nav class="navbar navbar-dark" id="nav">
    <div class="container-fluid">
        <a class="navbar-brand" href="home.html"><img src="../images/avatar_bombeiro.png" width="60px" /></a>
        <p class="navbar-title mt-3 fw-bold text">
            LOCALIZAÇÃO DOS TRAUMAS
        </p>
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar"
            aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar"
            aria-labelledby="offcanvasDarkNavbarLabel">
            <div class="offcanvas-header">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#">TELA DE INÍCIO</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            CATEGORIAS
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'ocorrencia.html'">TIPO DE OCORRÊNCIA</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" style="white-space: break-spaces"
                                    onclick="window.location.href = 'problemasuspeitos.html'">PROBLEMAS ENCONTRADOS
                                    SUSPEITOS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'sinaisesintomas.html'">SINAIS E SINTOMAS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'glasglow.html'">AVALIAÇÃO DO PACIENTE (GLASGOW)</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'ocorrencia.html'">LOCALIZAÇÃO DOS TRAUMAS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li><a class="dropdown-item" href="#" onclick="window.location.href = 'sinais.html'">SINAIS
                                    VITAIS</a></li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'objetos.html'">OBJETOS RECOLHIDOS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" style="white-space: break-spaces"
                                    onclick="window.location.href = 'conducao.html'">FORMA DE CONDUÇÃO E DECISÃO DE
                                    TRANSPORTE</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li><a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'vitimaera.html'">VÍTIMA ERA</a></li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'procedimentos.html'">PROCEDIMENTOS EFETUADOS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'materiaisutilizados.html'">MATERIAIS UTILIZADOS</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'obsimportante.html'">OBSERVAÇÕES IMPORTANTES</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="window.location.href = 'cinematica.html'">AVALIAÇÃO DA CINEMÁTICA</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item" style="list-style-type: none">
                        <a class="nav-link" href="#" onclick="window.location.href = 'perfilbombeiro.html'">PERFIL</a>
                    </li>
                    <li class="nav-item" style="list-style-type: none">
                        <a class="nav-link" href="#">SAIR</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div class="card mb-2 text-light">
    <div class="card-header">
    </div>
    <div class="card-body">
        <form id="TraumaLocForm">
            <!-- Adicione um campo de seleção para o tipo de trauma -->
            <label for="traumaType" class="mt-1 mb-2">Selecione o tipo de trauma:</label>
            <select id="traumaType" class="form-control mb-3">
                <!-- Adicione as opções de trauma aqui -->
                <option value="Fratura_Luxacao_Entorse">Fraturas/Luxações/Entorses</option>
                <option value="Ferimentos_diversos">Ferimentos diversos</option>
                <option value="Hemorragia">Hemorragia</option>
                <option value="Evisceracao">Evisceração</option>
                <option value="FAB_FAF">FAB/FAF</option>
                <option value="Amputacao">Amputação</option>
                <option value="Queimadura_1">Queimadura 1° grau</option>
                <option value="Queimadura_2">Queimadura 2° grau</option>
                <option value="Queimadura_3">Queimadura 3° grau</option>
            </select>

            <div class="row position-relative" id="imageContainer">
                <img id="humanBody" src="body.png" alt="body-image">
            </div>
            <!-- Buton to undo -->
            <div class="d-flex justify-content-center mt-4">
                <button type="button" class="btn btn-danger fw-bold" id="undoBtn">Desfazer</button>
            </div>
            <div class="container mt-3">
                <div class="row">
                    <div class="col-md-4">
                        <div class="table-responsive table-container">
                            <table class="table text-center text-break w-100">
                                <tbody>
                                    <tr>
                                        <th scope="row"><img src="Amputacao.png" alt="Amputação" class="img-small"></th>
                                        <td class="small">Amputação</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="Evisceracao.png" alt="Amputação" class="img-small">
                                        </th>
                                        <td class="small">Evisceração</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="FAB_FAF.png" alt="Amputação" class="img-small"></th>
                                        <td class="small">FAB/FAF</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="table-responsive table-container">
                            <table class="table text-center text-break w-100">
                                <tbody>
                                    <tr>
                                        <th scope="row"><img src="Ferimentos_diversos.png" alt="Amputação"
                                                class="img-small"></th>
                                        <td class="small">Ferimentos diversos</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="Fratura_Luxacao_Entorse.png" alt="Amputação"
                                                class="img-small"></th>
                                        <td class="small">Fratura/Luxação/Entorse</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="Hemorragia.png" alt="Amputação" class="img-small">
                                        </th>
                                        <td class="small">Hemorragia</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="table-responsive table-container">
                            <table class="table text-center text-break w-100">
                                <tbody>
                                    <tr>
                                        <th scope="row"><img src="Queimadura_1.png" alt="Amputação" class="img-small">
                                        </th>
                                        <td class="small">Queimadura 1° grau</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="Queimadura_2.png" alt="Amputação" class="img-small">
                                        </th>
                                        <td class="small">Queimadura 2° grau</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="Queimadura_3.png" alt="Amputação" class="img-small">
                                        </th>
                                        <td class="small">Queimadura 3° grau</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary" id="backBtn">Voltar</button>
                <button type="submit" class="btn btn-primary" id="nextBtn">Próximo</button>
            </div>
        </form>
    </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<script>
    function storeTraumaIcon(x, y, traumaType) {
        let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || [];
        traumaIcons.push({ x, y, traumaType });
        localStorage.setItem('traumaIcons', JSON.stringify(traumaIcons));
    }

    function removeLastTraumaIcon() {
        let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || [];
        if (traumaIcons.length > 0) {
            traumaIcons.pop();
            localStorage.setItem('traumaIcons', JSON.stringify(traumaIcons));

            // Remove o último ícone da imagem
            let imageContainer = document.getElementById('imageContainer');
            let lastIcon = imageContainer.lastElementChild;
            if (lastIcon.tagName === 'IMG') {
                imageContainer.removeChild(lastIcon);
            }
        }
    }

    function recreateTraumaImage() {
        let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || {};
        traumaIcons.forEach(icon => {
            createTraumaIcon(icon.x, icon.y, icon.traumaType);
        });
    }

    function createTraumaIcon(x, y, traumaType) {
        let icon = document.createElement('img');
        icon.src = `${traumaType}.png`;
        icon.style.position = 'absolute';
        let iconWidth = 50;
        let iconHeight = 50;
        icon.style.left = `${x - iconWidth / 2}px`;
        icon.style.top = `${y - iconHeight / 2}px`;
        icon.style.width = `${iconWidth}px`;
        icon.style.height = `${iconHeight}px`;
        icon.style.padding = '0';
        document.getElementById('imageContainer').appendChild(icon);
    }

    document.addEventListener('DOMContentLoaded', recreateTraumaImage);

    document.getElementById('undoBtn').addEventListener('click', function () {
        removeLastTraumaIcon();
    });

    document.getElementById('nextBtn').addEventListener('click', async function (e) {
        e.preventDefault();

        let canvas = await html2canvas(document.getElementById('imageContainer'));
        let imgData = canvas.toDataURL('image/png');

        // Recupera o objeto JSON existente ou cria um novo se não existir
        let formData = JSON.parse(localStorage.getItem('formData')) || {};

        // Adiciona a imagem ao objeto JSON
        formData['traumaImage'] = imgData;

        // Armazena o objeto JSON atualizado no localStorage
        localStorage.setItem('formData', JSON.stringify(formData));

        console.log('Stored Data:', formData);  // Imprime os dados armazenados no localStorage

        // Navega para a próxima página
        window.location.href = 'traumaDesc.html';
    });

    let img = document.getElementById('humanBody');
    img.addEventListener('click', function (e) {
        let x = e.offsetX;
        let y = e.offsetY;
        let traumaType = document.getElementById('traumaType').value;

        storeTraumaIcon(x, y, traumaType);
        createTraumaIcon(x, y, traumaType);
    });

    function imageLogin() {
        // Verify if the user is logged in
        fetch('/menu').then(res => res.json()).then(data => {
            if (data.loggedin) {
                // If the user is logged in, redirect to the menu
                window.location.href = '/menu.html';
            } else {
                // If the user is not logged in, redirect to the login page
                window.location.href = '/login.html';
            }
        }).catch(err => {
            console.error(err);
            alert('Erro de conexão!');
        });
    }

    // Get the active link
    const activeLink = document.querySelector('.list-group-item.active');

    // Scroll to the active link
    if (activeLink) {
        activeLink.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }

</script>
</body>

</html>