<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset=UTF-8>
    <!-- Linkagem -->
    <title>Localização Traumas</title>
    <!-- Titulo -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Poppins:wght@300&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Fonte -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width">
    <!-- media -->
    <link rel="icon" href="../images/avatar_bombeiro.png" type="image/png">
    <!--Imagem icon-->

    <script>

    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #7d7777;
            display: flex;
            background-color: #c1c1c1;
            font-family: 'Inter', sans-serif;
            color: white;
        }

        .base {
            width: 100vw;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* MENU */
        #nav {
            background-color: #333333;
        }

        .navbar-brand {
            display: flex;
            margin: 0px;
        }

        /* Tamanho titulo */
        @media screen and (max-width:460px) {

            .navbar-title {
                font-size: 13PX;
            }

        }

        /* Tamanho titulo */
        @media screen and (max-width:405px) {

            .navbar-title {
                font-size: 10.6PX;
            }

        }

        .column {
            display: flex;
            flex-direction: column;
            width: 100%;
            /* height: 196vh; */
            /* margin-top: -3px; */
            box-sizing: border-box;
            padding: 15px;
            justify-content: space-between;
        }

        .form-group {
            display: flex;
            justify-content: center;
        }

        .container-fluid-linha {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            margin-top: 50px;
            background-color: #333333;
            border-radius: 12px;
        }

        .card-body {
            display: flex;
            flex-direction: column;
            width: 90%;
        }

        #option {
            display: flex;
        }

        /* .form-control{
            display: flex;
            width: 100%;
        } */

        .corpo {
            display: flex;
            justify-content: center;
        }

        .row {
            display: flex;
            background-color: #333333;
            width: 70%;
            padding: 14px;
            border-radius: 11px;
        }

        /* Definindo estilos dos botões do rodapé */
        .espaço_botao {
            display: flex;
            width: 100%;
            height: 15vh;
            justify-content: center;
        }

        .botao {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
        }
    </style>

</head>

<body>
    <!-- Corpo intero -->
    <div class="base">
        <!--  Menu -->
        <nav class="navbar navbar-dark" id="nav">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"> <img src="../images/avatar_bombeiro.png" width="60px"></a>
                <p class="navbar-title mt-3 fw-bold">Localização de Traumas</p>
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar"
                    aria-labelledby="offcanvasDarkNavbarLabel">
                    <div class="offcanvas-header">
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="#">TELA DE INÍCIO</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    CATEGORIAS
                                </a>
                                <ul class="dropdown-menu dropdown-menu-dark">
                                    <li><a class="dropdown-item" href="#">TIPO DE OCORRÊNCIA</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#" style="white-space: break-spaces;">PROBLEMAS
                                            ENCONTRADOS SUSPEITOS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">SINAIS E SINTOMAS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">AVALIAÇÃO DO PACIENTE (GLASGOW)</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">LOCALIZAÇÃO DOS TRAUMAS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">SINAIS VITAIS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">OBJETOS RECOLHIDOS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#" style="white-space: break-spaces;">FORMA DE
                                            CONDUÇÃO E DECISÃO DE TRANSPORTE</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">VÍTIMA ERA</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">PROCEDIMENTOS EFETUADOS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">MATERIAIS UTILIZADOS</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">OBSERVAÇÕES IMPORTANTES</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#">AVALIAÇÃO DA CINEMÁTICA</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">PERFIL</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">SAIR</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <div class="column">
            <form action="">
                <div class="form-group">
                    <div class="container-fluid-linha">
                        <div class="card-body">
                            <form id="TraumaLocForm">
                                <div class="texto">
                                    Adicione um campo de seleção para o tipo de trauma
                                    <label for="traumaType" class="mt-1 mb-2">Selecione o tipo de trauma:</label>
                                </div>
                                <select id="traumaType" class="form-control mb-3">
                                    <option value="Fratura_Luxacao_Entorse">Fraturas/Luxações/Entorses</option>
                                    <option value="Ferimentos_diversos">Ferimentos diversos</option>
                                    <option value="Hemorragia">Hemorragia</option>
                                    <option value="Evisceracao">Evisceração</option>
                                    <option value="FAB_FAF">FAB/FAF</option>
                                    <option value="Amputacao">Amputação</option>
                                    <option value="Queimadura_1">Queimadura 1° grau</option>
                                    <option value="Queimadura_2">Queimadura 2° grau</option>
                                    <option value="Queimadura_3">Queimadura 3° grau</option>
                                </select>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="corpo">
                    <div class="row" id="imageContainer">
                        <img class="img" id="humanBody" src="../images/corpo_maior.PNG" alt="body-image">
                    </div>
                </div>
                <div class="d-flex justify-content-center mt-4">
                    <button type="button" class="btn btn-light fw-bold" id="undoBtn">Desfazer</button>
                </div>
                
                <div class="container mt-3 d-flex justify-content-center">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="table-responsive table-container">
                                <table class="table text-center text-break w-100">
                                    <tbody>
                                        <tr>
                                            <th scope="row"><img src="../images/Queimadura_1.png" alt="Amputação"
                                                    class="img-thumbnail"></th>
                                            <td class="small">Queimadura 1° grau</td>
                                        </tr>
                                        <tr>
                                            <th scope="row"><img src="../images/Queimadura_2.png" alt="Amputação"
                                                    class="img-thumbnail"></th>
                                            <td class="small">Queimadura 2° grau</td>
                                        </tr>
                                        <tr>
                                            <th scope="row"><img src="../images/Queimadura_3.png" alt="Amputação"
                                                    class="img-thumbnail"></th>
                                            <td class="small">Queimadura 3° grau</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="table-responsive table-container">
                                <table class="table text-center text-break w-100">
                                    <tbody>
                                        <tr>
                                            <th scope="row"><img src="../images/Fratura_Luxacao_Entorse.png"
                                                    alt="Amputação" class="img-thumbnail"></th>
                                            <td class="small">Fratura/Luxação/Entorse</td>
                                        </tr>
                                        <tr>
                                            <th scope="row"><img src="../images/Amputacao.png" alt="Amputação"
                                                    class="img-thumbnail"></th>
                                            <td class="small">Amputação</td>
                                        </tr>
                                        <tr>
                                            <th scope="row"><img src="../images/Evisceracao.png" alt="Amputação"
                                                    class="img-thumbnail"></th>
                                            <td class="small">Evisceração</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="table-responsive table-container">
                                <table class="table text-center text-break w-100">
                                    <tr>
                                        <th scope="row"><img src="../images/Ferimentos_diversos.png"
                                                alt="Amputação" class="img-thumbnail"></th>
                                        <td class="small">Ferimentos diversos</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="../images/FAB_FAF.png" alt="Amputação"
                                                class="img-thumbnail"></th>
                                        <td class="small">FAB/FAF</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"><img src="../images/Hemorragia.png" alt="Amputação"
                                                class="img-thumbnail"></th>
                                        <td class="small">Hemorragia</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="espaço_botao">
                    <div class="botao">
                        <button type="button" class="btn btn-outline-primary btn-lg" onclick="window.location.href = 'sinaisesintomashtml'">Voltar</button>
                        <button type="button" class="btn btn-outline-primary btn-lg" onclick="window.location.href = 'glasglow.html'">Proximo</button>
                    </div>
                </div>


            </form>

        </div>







    </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script>
        function storeTraumaIcon(x, y, traumaType) {
            let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || [];
            traumaIcons.push({ x, y, traumaType });
            localStorage.setItem('traumaIcons', JSON.stringify(traumaIcons));
        }

        function removeLastTraumaIcon() {
            let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || [];
            if (traumaIcons.length > 0) {
                traumaIcons.pop();
                localStorage.setItem('traumaIcons', JSON.stringify(traumaIcons));

                // Remove o último ícone da imagem
                let imageContainer = document.getElementById('imageContainer');
                let lastIcon = imageContainer.lastElementChild;
                if (lastIcon.tagName === 'IMG') {
                    imageContainer.removeChild(lastIcon);
                }
            }
        }

        function recreateTraumaImage() {
            let traumaIcons = JSON.parse(localStorage.getItem('traumaIcons')) || {};
            traumaIcons.forEach(icon => {
                createTraumaIcon(icon.x, icon.y, icon.traumaType);
            });
        }

        function createTraumaIcon(x, y, traumaType) {
            let icon = document.createElement('img');
            icon.src = `/trauma_icon/${traumaType}.png`;
            icon.style.position = 'absolute';
            let iconWidth = 50;
            let iconHeight = 50;
            icon.style.left = `${x - iconWidth / 2}px`;
            icon.style.top = `${y - iconHeight / 2}px`;
            icon.style.width = `${iconWidth}px`;
            icon.style.height = `${iconHeight}px`;
            icon.style.padding = '0';
            document.getElementById('imageContainer').appendChild(icon);
        }

        document.addEventListener('DOMContentLoaded', recreateTraumaImage);

        document.getElementById('undoBtn').addEventListener('click', function () {
            removeLastTraumaIcon();
        });

        document.getElementById('nextBtn').addEventListener('click', async function (e) {
            e.preventDefault();

            let canvas = await html2canvas(document.getElementById('imageContainer'));
            let imgData = canvas.toDataURL('image/png');

            // Recupera o objeto JSON existente ou cria um novo se não existir
            let formData = JSON.parse(localStorage.getItem('formData')) || {};

            // Adiciona a imagem ao objeto JSON
            formData['traumaImage'] = imgData;

            // Armazena o objeto JSON atualizado no localStorage
            localStorage.setItem('formData', JSON.stringify(formData));

            console.log('Stored Data:', formData);  // Imprime os dados armazenados no localStorage

            // Navega para a próxima página
            window.location.href = 'traumaDesc.html';
        });

        let img = document.getElementById('humanBody');
        img.addEventListener('click', function (e) {
            let x = e.offsetX;
            let y = e.offsetY;
            let traumaType = document.getElementById('traumaType').value;

            storeTraumaIcon(x, y, traumaType);
            createTraumaIcon(x, y, traumaType);
        });

        function imageLogin() {
            // Verify if the user is logged in
            fetch('/menu').then(res => res.json()).then(data => {
                if (data.loggedin) {
                    // If the user is logged in, redirect to the menu
                    window.location.href = '';
                } else {
                    // If the user is not logged in, redirect to the login page
                    window.location.href = '';
                }
            }).catch(err => {
                console.error(err);
                alert('Erro de conexão!');
            });
        }
    </script>



</body>

</html>